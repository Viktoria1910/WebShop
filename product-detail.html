<!DOCTYPE html>
<html lang="hr">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Detalji proizvoda - Nuvion WebShop</title>
  <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.2/dist/css/bootstrap.min.css" rel="stylesheet">
  <link rel="stylesheet" href="css/style.css">
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.5.0/css/all.min.css">
  <style>
    body { padding-top: 90px; background: #0f001a; color: #e0ccff; }
    .back-btn { color: #b794ff; text-decoration: none; font-size: 1.1rem; margin: 1rem 0; display: inline-block; }
    .back-btn:hover { color: #e945e9; }

    .product-detail { max-width: 1100px; margin: 2rem auto; background: rgba(30,10,60,0.95); border-radius: 20px; overflow: hidden; border: 2px solid #9f54ff; box-shadow: 0 0 60px rgba(159,84,255,0.5); backdrop-filter: blur(12px); }
    .product-img { width: 100%; height: 380px; object-fit: cover; }
    .product-info { padding: 2rem; }
    .product-title { font-size: 2.4rem; font-weight: 900; background: linear-gradient(45deg, #c724ff, #e945e9); -webkit-background-clip: text; background-clip: text; -webkit-text-fill-color: transparent; margin-bottom: 0.5rem; }
    .product-manufacturer { font-size: 1.2rem; color: #b794ff; margin-bottom: 1rem; }
    .product-desc { font-size: 1.1rem; line-height: 1.6; margin-bottom: 1.2rem; max-height: 80px; overflow: hidden; }
    .product-price { font-size: 2.8rem; color: #c724ff; text-shadow: 0 0 30px #c724ff; margin: 1rem 0; }
    .specs-table { font-size: 0.95rem; margin-bottom: 1.5rem; }
    .specs-table td { padding: 0.5rem 1rem; border-bottom: 1px solid rgba(159,84,255,0.3); }
    .specs-table td:first-child { color: #c724ff; font-weight: bold; width: 45%; }
    .btn-add-large { background: linear-gradient(45deg, #9f54ff, #c724ff); border: none; padding: 1rem 3.5rem; font-size: 1.4rem; border-radius: 50px; box-shadow: 0 0 40px rgba(199,36,255,0.8); }
    .btn-add-large:hover { transform: translateY(-6px) scale(1.05); box-shadow: 0 0 70px rgba(233,69,233,0.9); }
  </style>
</head>
<body>

 <div id="navbar"></div> 
    <div id="footer"></div>

  <div class="container">
    <a href="products.html" class="back-btn">Back to products Povratak na proizvode</a>
    <div class="product-detail" id="product-detail"></div>
  </div>

  <div id="footer"></div>

  <div class="cart-float">
    <a href="cart.html" title="Košarica">
      <i class="fas fa-shopping-cart"></i>
      <span class="badge" id="cart-count-float">0</span>
    </a>
  </div>

  <script type="module">
    import { db } from "./js/firebase-config.js";
    import { doc, getDoc } from "https://www.gstatic.com/firebasejs/10.7.0/firebase-firestore.js";

    const urlParams = new URLSearchParams(window.location.search);
    const productId = urlParams.get('id');
    const container = document.getElementById("product-detail");

    if (!productId) {
      container.innerHTML = "<h2 class='text-center p-5'>Nema ID-a</h2>";
      return;
    }

    try {
      const docRef = doc(db, "products", productId);
      const docSnap = await getDoc(docRef);

      if (!docSnap.exists()) {
        container.innerHTML = "<h2 class='text-center p-5'>Proizvod nije pronađen</h2>";
      } else {
        const p = docSnap.data();
        let specsHTML = "";
        for (const [key, value] of Object.entries(p.specs || {})) {
          specsHTML += `<tr><td>${key}</td><td>${value}</td></tr>`;
        }

        container.innerHTML = `
          <div class="row g-0">
            <div class="col-lg-5">
              <img src="${p.img}" alt="${p.name}" class="product-img">
            </div>
            <div class="col-lg-7 product-info">
              <h1 class="product-title">${p.name}</h1>
              <p class="product-manufacturer">Proizvođač: <strong>${p.manufacturer}</strong></p>
              <p class="product-desc">${p.description}</p>
              <table class="table specs-table"><tbody>${specsHTML}</tbody></table>
              <div class="product-price">${p.price.toFixed(2)} €</div>
              <button class="btn btn-add-large" onclick="addToCart('${docSnap.id}', '${p.name.replace(/'/g, "\\'")}', ${p.price})">
                Dodaj u košaricu
              </button>
            </div>
          </div>
        `;
      }
    } catch (error) {
      container.innerHTML = "<p class='text-center text-danger'>Greška pri učitavanju.</p>";
      console.error(error);
    }

    window.addToCart = function(id, name, price) {
      let cart = JSON.parse(localStorage.getItem("cart") || "[]");
      const existing = cart.find(item => item.id === id);
      if (existing) existing.qty += 1;
      else cart.push({ id, name, price, qty: 1 });
      localStorage.setItem("cart", JSON.stringify(cart));
      updateCartCount();
      alert("Dodano u košaricu!");
    };

    function updateCartCount() {
      const cart = JSON.parse(localStorage.getItem("cart") || "[]");
      const count = cart.reduce((s, i) => s + i.qty, 0);
      document.getElementById("cart-count-float").textContent = count;
    }
    updateCartCount();
  </script>
</body>
</html>