<!DOCTYPE html>
<html lang="hr">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Proizvodi - Nuvion WebShop</title>
  <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.2/dist/css/bootstrap.min.css" rel="stylesheet">
  <link rel="stylesheet" href="css/style.css">
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.5.0/css/all.min.css">
  <style>
    body { padding-top: 90px; background: #0f001a; color: #e0ccff; }
    @media (max-width: 768px) { body { padding-top: 80px; } }

    h1 {
      text-align: center;
      margin: 3rem 0 4rem;
      font-size: 4rem;
      text-transform: uppercase;
      letter-spacing: 8px;
      background: linear-gradient(45deg, #8e44ad, #9f54ff, #c724ff, #9f54ff, #8e44ad);
      background-size: 300% 300%;
      -webkit-background-clip: text;
      background-clip: text;
      -webkit-text-fill-color: transparent;
      text-shadow: 0 0 40px rgba(159,84,255,0.7);
      animation: plavaLjubicasta 6s ease-in-out infinite;
    }
    @keyframes plavaLjubicasta { 0%,100% { background-position: 0% 50%; } 50% { background-position: 100% 50%; } }

    .product-card {
      background: rgba(30,10,60,0.85);
      border: 1px solid #9f54ff;
      border-radius: 18px;
      overflow: hidden;
      transition: all 0.4s ease;
      height: 100%;
      cursor: pointer;
      backdrop-filter: blur(10px);
      box-shadow: 0 8px 32px rgba(0,0,0,0.4);
      display: flex;
      flex-direction: column;
    }
    .product-card:hover { transform: translateY(-15px) scale(1.02); box-shadow: 0 30px 60px rgba(159,84,255,0.6); border-color: #e945e9; }
    
    .product-img { height: 260px; object-fit: cover; width: 100%; transition: transform 0.6s ease; }
    .product-card:hover .product-img { transform: scale(1.1); }
    
    .card-body { padding: 1.8rem; text-align: center; flex-grow: 1; display: flex; flex-direction: column; justify-content: space-between; }
    
    .product-title { color: #ffffff; font-size: 1.35rem; font-weight: 700; margin-bottom: 0.8rem; text-shadow: 0 0 15px rgba(199,36,255,0.5); }
    .product-price { font-size: 2rem; font-weight: bold; color: #c724ff; text-shadow: 0 0 20px #c724ff; margin: 1rem 0; }
    
    .btn-add { 
      background: linear-gradient(45deg, #9f54ff, #c724ff); 
      border: none; 
      padding: 0.9rem 2.2rem; 
      border-radius: 50px; 
      font-weight: bold; 
      color: white;
      transition: all 0.4s; 
      box-shadow: 0 0 30px rgba(199,36,255,0.7); 
    }
    .btn-add:hover { transform: translateY(-3px); box-shadow: 0 0 50px rgba(233,69,233,0.9); color: white; }
  </style>
</head>
<body>

  <div id="navbar"></div>

  <div class="container">
    <h1>Naša ponuda</h1>
    <div class="row row-cols-1 row-cols-md-2 row-cols-lg-3 row-cols-xl-4 g-5" id="products-container">
      <div class="text-center w-100">
        <div class="spinner-border text-primary" role="status"></div>
        <p>Učitavanje proizvoda...</p>
      </div>
    </div>
  </div>

  <div id="footer"></div>

  <div class="cart-float">
    <a href="cart.html" title="Košarica">
      <i class="fas fa-shopping-cart"></i>
      <span class="badge" id="cart-count-float">0</span>
    </a>
  </div>

<script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.2/dist/js/bootstrap.bundle.min.js"></script>

<script type="module" src="js/main.js"></script>
<script type="module" src="js/auth.js"></script>

  <script type="module">
    import { db } from "./js/firebase-config.js";
    import { collection, getDocs } from "https://www.gstatic.com/firebasejs/10.7.0/firebase-firestore.js";

    const container = document.getElementById("products-container");

    // Funkcija za dohvaćanje proizvoda iz Firebase-a
    async function loadProducts() {
      try {
        const querySnapshot = await getDocs(collection(db, "products"));
        container.innerHTML = ""; // Brišemo spinner

        if (querySnapshot.empty) {
            container.innerHTML = "<p class='text-center w-100'>Trenutno nema dostupnih proizvoda.</p>";
            return;
        }

        querySnapshot.forEach((doc) => {
          const p = doc.data();
          const col = document.createElement("div");
          col.className = "col";
          
          // Kartica proizvoda
          col.innerHTML = `
            <div class="product-card" onclick="window.location='product-detail.html?id=${doc.id}'">
              <img src="${p.img || 'https://via.placeholder.com/300'}" alt="${p.name}" class="product-img">
              <div class="card-body">
                <h3 class="product-title">${p.name}</h3>
                <p class="product-price">${p.price.toFixed(2)} €</p>
                <button class="btn btn-add" onclick="event.stopPropagation(); addToCart('${doc.id}', '${p.name.replace(/'/g, "\\'")}', ${p.price})">
                  Dodaj u košaricu
                </button>
              </div>
            </div>
          `;
          container.appendChild(col);
        });
      } catch (error) {
        container.innerHTML = `<p class="text-center text-danger w-100">Greška pri učitavanju: ${error.message}</p>`;
        console.error("Firebase Error:", error);
      }
    }

    // Globalne funkcije za košaricu (dostupne onclick gumbima)
    window.addToCart = function(id, name, price) {
      let cart = JSON.parse(localStorage.getItem("cart") || "[]");
      const existing = cart.find(item => item.id === id);
      
      if (existing) {
        existing.qty += 1;
      } else {
        cart.push({ id, name, price, qty: 1 });
      }
      
      localStorage.setItem("cart", JSON.stringify(cart));
      updateCartCount();

      // Vizualna potvrda na gumbu
      const btn = event.target;
      const originalText = btn.innerHTML;
      btn.innerHTML = "Dodano!";
      btn.style.background = "linear-gradient(45deg, #28a745, #218838)";
      
      setTimeout(() => {
        btn.innerHTML = originalText;
        btn.style.background = "";
      }, 1000);
    };

    window.updateCartCount = function() {
      const cart = JSON.parse(localStorage.getItem("cart") || "[]");
      const total = cart.reduce((s, i) => s + i.qty, 0);
      const badge = document.getElementById("cart-count-float");
      if (badge) badge.textContent = total;
    };

    // Inicijalizacija
    loadProducts();
    window.updateCartCount();
  </script>
</body>
</html>